{"version":3,"sources":["__temp/buildOnlyScriptProcess/inlineFunctionProcess/Scripts/PlayerInfo.ts"],"names":[],"mappings":"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","file":"PlayerInfo.js","sourcesContent":["import engine from \"engine\";\nimport { urlToSpriteFrame, invite } from \"./utils\";\n\n\n@engine.decorators.serialize(\"PlayerInfo\")\nexport default class PlayerInfo extends engine.Script {\n    @engine.decorators.property({\n        type: engine.TypeNames.Number\n    })\n    public distFromMe: number;\n\n\n    private inviteButton: engine.UIButton;\n    private inviteTouchInput: engine.TouchInputComponent;\n    private avatarSprite: engine.UISprite;\n    private nicknameLabel: engine.UILabel;\n\n    private seat: number;\n    private defaultAvatar: engine.SpriteFrame;\n\n    public onAwake() {\n        const avatarEntity = this.entity.transform2D.findChildByName('CircleMask').children[0].entity;\n        this.inviteButton = avatarEntity.getComponent(engine.UIButton);\n        this.inviteTouchInput = avatarEntity.getComponent(engine.TouchInputComponent);\n        this.avatarSprite = avatarEntity.getComponent(engine.UISprite);\n        this.nicknameLabel = this.entity.transform2D.findChildByName('Nickname').entity.getComponent(engine.UILabel);\n\n        this.defaultAvatar = this.avatarSprite.spriteFrame as engine.SpriteFrame;\n\n        engine.game.customEventEmitter.on('get_player_info_result', data => {\n            this.seat = (data.my_seat + this.distFromMe) % 4;\n            const info = data.player_list[this.seat];\n            console.log(`#${this.seat} player info`, info);\n\n            if (info) {\n                this.showInfo(info);\n            } else {\n                this.showDefault();\n            }\n        });\n\n        engine.game.customEventEmitter.on('player_enter', data => {\n            if (data.seat === this.seat) {\n                this.showInfo(data.info);\n            }\n        });\n        engine.game.customEventEmitter.on('player_exit', data => {\n            if (data.seat === this.seat) {\n                this.showDefault();\n            }\n        });\n        engine.game.customEventEmitter.on('player_update_ready_status', data => {\n            if (data.seat === this.seat) {\n                this.avatarSprite.grayScale = !data.is_ready;\n            }\n        });\n    }\n\n    private showInfo({ nickname, avatar_url, is_ready }) {\n        urlToSpriteFrame(avatar_url).then((spriteFrame: engine.SpriteFrame) => {\n            this.avatarSprite.spriteFrame = spriteFrame;\n        });\n        this.avatarSprite.grayScale = !is_ready;\n        this.nicknameLabel.text = nickname;\n        this.inviteButton.disable = true;\n        this.inviteTouchInput.onClick.clear();\n    }\n\n    private showDefault() {\n        this.avatarSprite.spriteFrame = this.defaultAvatar;\n        this.avatarSprite.grayScale = false;\n        this.nicknameLabel.text = '点击邀请好友';\n        this.inviteButton.disable = false;\n        this.inviteTouchInput.onClick.add(() => {\n            invite();\n        });\n    }\n}\n"]}