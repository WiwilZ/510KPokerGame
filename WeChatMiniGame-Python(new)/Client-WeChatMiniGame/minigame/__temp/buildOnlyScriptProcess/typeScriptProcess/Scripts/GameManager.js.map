{"version":3,"sources":["__temp/buildOnlyScriptProcess/inlineFunctionProcess/Scripts/GameManager.ts"],"names":[],"mappings":"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","file":"GameManager.js","sourcesContent":["import engine from \"engine\";\nimport LRUCache from \"./LRUCache\";\nimport GameServer from \"./GameServer\"\n\n\ninterface UserInfo {\n    nickname: string,\n    avatarUrl: string,\n    openid: string\n}\n\n\ninterface PlayerInfo {\n    avatar: engine.SpriteFrame,\n    nickname: string,\n    isReady: boolean,\n}\n\n\ninterface RoomInfo {\n    roomNo: number,\n    mySeat: number,\n    playerList: PlayerInfo[]\n}\n\n\ninterface PlayerComp {\n    avatarSprite: engine.UISprite,\n    readySprite: engine.UISprite,\n    nicknameLabel: engine.UILabel,\n    inviteButton?: engine.UIButton\n}\n\n\n@engine.decorators.serialize(\"GameManager\")\nexport default class GameManager extends engine.Script {\n    @engine.decorators.property({\n        type: engine.Transform2D,\n        required: true\n    })\n    public home: engine.Transform2D;\n\n    @engine.decorators.property({\n        type: engine.Transform2D,\n        required: true\n    })\n    public room: engine.Transform2D;\n\n\n    @engine.decorators.property({\n        type: engine.TouchInputComponent,\n        required: true\n    })\n    public createRoomTouchInput: engine.TouchInputComponent;\n\n    @engine.decorators.property({\n        type: engine.TouchInputComponent,\n        required: true\n    })\n    public exitRoomTouchInput: engine.TouchInputComponent;\n\n    @engine.decorators.property({\n        type: engine.UIButton,\n        required: true\n    })\n    public getReadyButton: engine.UIButton;\n\n    @engine.decorators.property({\n        type: engine.TouchInputComponent,\n        required: true\n    })\n    public getReadyTouchInput: engine.TouchInputComponent;\n\n    @engine.decorators.property({\n        type: engine.Atlas,\n        required: true\n    })\n    public cardAtlas: engine.Atlas;\n\n    @engine.decorators.property({\n        type: engine.SpriteFrame,\n        required: true\n    })\n    public defaultAvatar: engine.SpriteFrame;\n\n    @engine.decorators.property({\n        type: [engine.Transform2D],\n        required: true\n    })\n    public playerTransList: engine.Transform2D[] = [];\n\n\n    private playerCompList: PlayerComp[] = [];\n\n\n    private gameServer: GameServer;\n\n    private avatarCache = new LRUCache(4);\n    private isInBattle = false;\n\n    private userInfo: UserInfo = {\n        nickname: '',\n        avatarUrl: '',\n        openid: ''\n    };\n    private hasUserInfo = false;\n    private roomInfo: RoomInfo;\n\n    private APPID = 'wx76fd3cf02125f9e2';\n    private SECRET = '445898eda089aa3a1357a6e40d7d1cda';\n\n\n    public onAwake() {\n        console.log(this.cardAtlas.spriteframes);\n\n        this.resetRoomInfo();\n\n        this.createRoomTouchInput.onClick.add(this.createRoom.bind(this));\n        this.exitRoomTouchInput.onClick.add(this.exitRoom.bind(this));\n        this.getReadyTouchInput.onClick.add(() => {\n            if (!this.getReadyButton.disable) {\n                this.updateReadyStatus();\n                this.getReadyButton.disable = true;\n            }\n        });\n\n        this.initPlayerCompList();\n\n        wx.onShow(({ query }) => {\n            console.log('onShow query', query);\n\n            if (this.hasUserInfo) {\n                this.gameServer.reconnect();\n                this.launchWithRoomNo(query);\n            } else {\n                this.getUserInfo().then(() => {\n                    this.gameServer = new GameServer(this.userInfo, this.onMessage.bind(this));\n                    this.launchWithRoomNo(query);\n                });\n            }\n        });\n    }\n\n    public onStart() {\n        wx.showLoading({\n            title: '加载中...',\n            mask: true\n        }).then(() => {\n            this.getUserInfo().then(() => {\n                this.gameServer = new GameServer(this.userInfo, this.onMessage.bind(this));\n            }).finally(() => {\n                wx.hideLoading();\n            });\n        });\n    }\n\n    private getUserInfo() {\n        return new Promise((resolve, reject) => {\n            this.getUserProfile().then(() => {\n                this.getOpenid().then(() => {\n                    this.hasUserInfo = true;\n                    resolve();\n                }).catch(reject);\n            }).catch(() => {\n                wx.showToast({\n                    title: \"请允许获得授权\",\n                    icon: 'error',\n                    duration: 1500\n                });\n                reject();\n            });\n        });\n    }\n\n    private getOpenid() {\n        return new Promise((resolve, reject) => {\n            wx.login().then(({ code }) => {\n                wx.request({\n                    url: `https://api.weixin.qq.com/sns/jscode2session?appid=${this.APPID}&secret=${this.SECRET}&js_code=${code}&grant_type=authorization_code`,\n                    success: ({ data }) => {\n                        this.userInfo.openid = data.openid;\n                        console.log('openid', data.openid);\n                        resolve();\n                    },\n                    fail: () => {\n                        reject();\n                    }\n                });\n            }).catch(reject);\n        });\n    }\n\n    private getUserProfile() {\n        return new Promise((resolve, reject) => {\n            wx.getUserProfile({\n                desc: \"授权获取用户信息\"\n            }).then(({ userInfo }) => {\n                if (userInfo) {\n                    const { nickName, avatarUrl } = userInfo;\n                    this.userInfo.nickname = nickName\n                    this.userInfo.avatarUrl = avatarUrl;\n                    console.log('nickname', nickName);\n                    console.log('avatarUrl', avatarUrl);\n                    resolve();\n                } else {\n                    reject();\n                }\n            }).catch(reject);\n        });\n    }\n\n    private onMessage(event) {\n        console.log('receive event', event);\n        switch (event.action) {\n            case 'MATCH_ROOM':\n            case 'CREATE_ROOM':\n            case 'JOIN_ROOM':\n                if (event.data.code) {\n                    wx.hideLoading();\n                    wx.showToast({\n                        title: event.data.msg,\n                        icon: 'error',\n                        duration: 2000\n                    });\n                } else {\n                    this.roomInfo.roomNo = event.data.room_no;\n                    this.updateRoomInfoPlayerList(event.data).then(() => {\n                        this.enterRoom();\n                        this.showPlayerInfo();\n                        wx.hideLoading();\n                    });\n                }\n                break;\n\n            case 'GET_PLAYERS_INFO':\n            case 'ON_PLAYERS_INFO_UPDATE':\n                console.log(event.action, event.data);\n                this.updateRoomInfoPlayerList(event.data).then(() => {\n                    if (this.isInBattle) {\n                        wx.showModal({\n                            title: '温馨提示',\n                            content: '有玩家退出游戏',\n                            showCancel: false\n                        }).then(() => {\n                            this.resetRoomScene();\n                            this.showPlayerInfo();\n                        });\n                    } else {\n                        this.showPlayerInfo();\n                        if (this.roomInfo.playerList.length === 4 && this.roomInfo.playerList.every(v => v.isReady) && this.roomInfo.mySeat === 0) {\n                            this.gameServer.send({\n                                event: 'START'\n                            });\n                        }\n                    }\n                });\n                break;\n\n            case 'START':\n                this.roomInfo.playerList.forEach(player => {\n                    player.isReady = false;\n                });\n                if (this.roomInfo.mySeat === 0) {\n                    setTimeout(() => {\n                        this.gameServer.send({\n                            event: 'DEAL'\n                        });\n                    }, 3000);\n                }\n                wx.showToast({\n                    title: \"游戏即将开始...\",\n                    icon: 'none',\n                    duration: 3000\n                });\n                break;\n            case 'DEAL':\n            case 'CHANGE_BANKER_CARD':\n            case 'PLAY':\n        }\n    }\n\n    private launchWithRoomNo(query) {\n        let roomNo = query.roomNo;\n        console.log('roomNo: ', roomNo);\n\n        if (!roomNo) return;\n        roomNo = parseInt(roomNo);\n        if (!this.roomInfo.roomNo) {\n            this.roomInfo.roomNo = roomNo;\n            this.joinRoom();\n            return;\n        }\n        if (this.roomInfo.roomNo !== roomNo) {\n            this.gameServer.send({\n                action: 'EXIT_ROOM'\n            });\n            this.roomInfo.roomNo = roomNo;\n            this.joinRoom();\n        }\n    }\n\n    private resetRoomInfo() {\n        this.roomInfo = {\n            roomNo: null,\n            mySeat: null,\n            playerList: []\n        };\n    }\n\n    private createRoom() {\n        wx.showLoading({\n            'title': '加载中...',\n            mask: true\n        });\n        this.gameServer.send({\n            action: 'CREATE_ROOM'\n        });\n    }\n\n    private joinRoom() {\n        this.gameServer.send({\n            action: 'JOIN_ROOM',\n            data: this.roomInfo.roomNo\n        });\n    }\n\n    private exitRoom() {\n        wx.showModal({\n            title: '温馨提示',\n            content: '确定离开房间吗？',\n            showCancel: true\n        }).then(res => {\n            if (res.confirm) {\n                this.gameServer.send({\n                    action: 'EXIT_ROOM'\n                });\n                this.enterHome();\n            }\n        });\n    }\n\n    private enterHome() {\n        this.room.entity.active = false;\n        this.home.entity.active = true;\n    }\n\n    private enterRoom() {\n        this.resetRoomScene();\n        this.room.entity.active = true;\n        this.home.entity.active = false;\n    }\n\n    private resetRoomScene() {\n        this.getReadyButton.disable = false;\n        this.getReadyButton.entity.active = true;\n\n        this.playerCompList.forEach((comp, i) => {\n            comp.avatarSprite.spriteFrame = this.defaultAvatar;\n            comp.readySprite.visible = false;\n            comp.nicknameLabel.text = '';\n            if (i !== 0) {\n                comp.nicknameLabel.text = '点击邀请好友';\n                comp.inviteButton.disable = false;\n            }\n        });\n    }\n\n    private showPlayerInfo() {\n        this.playerCompList.slice(1).forEach(comp => {\n            comp.avatarSprite.spriteFrame = this.defaultAvatar;\n            comp.readySprite.visible = false;\n            comp.nicknameLabel.text = '点击邀请好友';\n            comp.inviteButton.disable = false;\n        });\n\n        this.roomInfo.playerList.forEach(({ avatar, nickname, isReady }, i) => {\n            const comp = this.playerCompList[this.indexFromMe(i)];\n            comp.avatarSprite.spriteFrame = avatar;\n            comp.readySprite.grayScale = !isReady;\n            comp.readySprite.visible = true;\n            comp.nicknameLabel.text = nickname;\n            if (i !== this.roomInfo.mySeat) {\n                comp.inviteButton.disable = true;\n            }\n        });\n    }\n\n    private updateReadyStatus() {\n        this.gameServer.send({\n            action: 'UPDATE_READY_STATUS'\n        });\n    }\n\n    private updateRoomInfoPlayerList({ players, seat }) {\n        this.roomInfo.mySeat = seat;\n\n        return Promise.all<PlayerInfo>(\n            players.map(({ nickname, avatar_url, is_ready }) => {\n                const avatar = this.avatarCache.get(avatar_url);\n                if (avatar) {\n                    return Promise.resolve({\n                        avatar,\n                        nickname,\n                        isReady: is_ready\n                    });\n                }\n                return this.urlToSpriteFrame(avatar_url).then(avatar => {\n                    this.avatarCache.add(avatar_url, avatar);\n                    return Promise.resolve({\n                        avatar,\n                        nickname,\n                        isReady: is_ready\n                    });\n                });\n            })\n        ).then(res => {\n            this.roomInfo.playerList = res;\n            console.log('updateRoomInfoPlayerList', res);\n            return Promise.resolve();\n        });\n    }\n\n    private initPlayerCompList() {\n        for (let i = 0; i < 4; i++) {\n            const playerTrans = this.playerTransList[i];\n            const avatarTrans = playerTrans.findChildByName('Avatar');\n            const comp: PlayerComp = {\n                avatarSprite: avatarTrans.entity.getComponent(engine.UISprite),\n                readySprite: avatarTrans.children[0].entity.getComponent(engine.UISprite),\n                nicknameLabel: playerTrans.findChildByName('Nickname').entity.getComponent(engine.UILabel)\n            };\n            if (i > 0) {\n                comp.inviteButton = avatarTrans.entity.getComponent(engine.UIButton);\n                (avatarTrans.entity.getComponent(engine.TouchInputComponent) as engine.TouchInputComponent).onClick.add(() => {\n                    if (!comp.inviteButton.disable) {\n                        this.invite();\n                    }\n                });\n            }\n            this.playerCompList[i] = comp;\n        }\n    }\n\n    private indexFromMe(seat: number) {\n        return (seat - this.roomInfo.mySeat + 4) % 4;\n    }\n\n    private urlToSpriteFrame(url: string) {\n        return new Promise((resolve, reject) => {\n            const img = new engine.Image();\n            img.onerror = err => {\n                console.error(err);\n                reject();\n            };\n            img.onload = () => {\n                const texture = new engine.Texture2D();\n                if (texture.initWithImage(img)) {\n                    const spriteFrame = engine.SpriteFrame.createFromTexture(texture);\n                    resolve(spriteFrame);\n                } else {\n                    reject();\n                }\n            }\n            img.src = url;\n        });\n    }\n\n    private invite() {\n        engine.canvas.toTempFilePath({\n            destWidth: 500,\n            destHeight: 400\n        }).then(res => {\n            wx.shareAppMessage({\n                title: '5 10 K',\n                query: `roomNo=${this.roomInfo.roomNo}`,\n                imageUrl: res.tempFilePath\n            });\n        });\n    }\n\n    private deal() {\n\n    }\n}\n"]}