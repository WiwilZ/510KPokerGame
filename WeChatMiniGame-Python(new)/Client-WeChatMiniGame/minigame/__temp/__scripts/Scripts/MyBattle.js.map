{"version":3,"sources":["Scripts/MyBattle.ts"],"names":[],"mappings":"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","file":"MyBattle.js","sourcesContent":["import engine from \"engine\";\nimport { databus } from \"./Databus\";\nimport MyHandCard from \"./MyHandCard\";\nimport { ActionModel, CardHeap } from \"./utils\";\n\n\n\n@engine.decorators.serialize(\"MyBattle\")\nexport default class MyBattle extends engine.Script {\n    @engine.decorators.property({\n        type: engine.TypeNames.UISprite\n    })\n    public bankerCardSprite: engine.UISprite;\n\n    @engine.decorators.property({\n        type: engine.TypeNames.UIButton\n    })\n    public playButton: engine.UIButton;\n    @engine.decorators.property({\n        type: engine.TypeNames.TouchInput\n    })\n    public playTouchInput: engine.TouchInputComponent;\n\n    @engine.decorators.property({\n        type: engine.TypeNames.UIButton\n    })\n    public passButton: engine.UIButton;\n    @engine.decorators.property({\n        type: engine.TypeNames.TouchInput\n    })\n    public passTouchInput: engine.TouchInputComponent;\n\n    @engine.decorators.property({\n        type: engine.TypeNames.UIButton\n    })\n    public changeButton: engine.UIButton;\n    @engine.decorators.property({\n        type: engine.TypeNames.TouchInput\n    })\n    public changeTouchInput: engine.TouchInputComponent;\n\n    @engine.decorators.property({\n        type: engine.TypeNames.UIButton\n    })\n    public skipButton: engine.UIButton;\n    @engine.decorators.property({\n        type: engine.TypeNames.TouchInput\n    })\n    public skipTouchInput: engine.TouchInputComponent;\n\n    @engine.decorators.property({\n        type: engine.TypeNames.Transform2D\n    })\n    public myHandTrans: engine.Transform2D;\n\n    @engine.decorators.property({\n        type: engine.TypeNames.Transform2D\n    })\n    public myActionTrans: engine.Transform2D;\n\n    @engine.decorators.property({\n        type: engine.TypeNames.UISprite\n    })\n    public passSprite: engine.UISprite;\n\n\n    private handCompList: {\n        sprite: engine.UISprite,\n        script: MyHandCard\n    }[];\n    private actionSpriteList: engine.UISprite[];\n\n    private selectedActionCards = new CardHeap();\n    private selectedBankerCard: MyHandCard;\n    private lastActionModel: ActionModel;\n\n    private onClickHandCard: (selected: boolean, script: MyHandCard) => void;\n\n    private playerExitHandler;\n    private dealHandler;\n    private playerPlayHandler;\n\n\n    public onAwake() {\n        this.init();\n\n        this.changeTouchInput.onClick.add(this.change.bind(this));\n        this.skipTouchInput.onClick.add(this.skip.bind(this));\n        this.playTouchInput.onClick.add(this.play.bind(this));\n        this.passTouchInput.onClick.add(this.pass.bind(this));\n\n        engine.game.customEventEmitter.on('player_exit', this.playerExitHandler);\n        engine.game.customEventEmitter.on('deal', this.dealHandler);\n        engine.game.customEventEmitter.on('player_play', this.playerPlayHandler);\n\n        this.reset();\n    }\n\n    public onDestroy() {\n        engine.game.customEventEmitter.removeListener('player_exit', this.playerExitHandler);\n        engine.game.customEventEmitter.removeListener('deal', this.dealHandler);\n        engine.game.customEventEmitter.removeListener('player_play', this.playerPlayHandler);\n    }\n\n    private init() {\n        this.handCompList = this.myHandTrans.children.map(v => {\n            const script = v.entity.getComponent<MyHandCard>(engine.Script);\n            script.onClickCallback = selected => this.onClickHandCard(selected, script);\n            return {\n                sprite: v.entity.getComponent(engine.UISprite),\n                script\n            };\n        });\n        this.actionSpriteList = this.myActionTrans.children.map(v => v.entity.getComponent(engine.UISprite));\n\n        this.playerExitHandler = this.onPlayerExit.bind(this);\n        this.dealHandler = this.onDeal.bind(this);\n        this.playerPlayHandler = this.onPlayerPlay.bind(this);\n    }\n\n    private reset() {\n        this.bankerCardSprite.visible = false;\n\n        this.selectedActionCards.clear();\n        this.selectedBankerCard = null;\n        this.lastActionModel = null;\n\n        this.hideHand();\n        this.hideAction();\n\n        this.hideChangeSkip();\n        this.disableChange();\n\n        this.hidePlayPass();\n        this.disablePlay();\n    }\n\n    private onPlayerExit() {\n        this.reset();\n    }\n\n    private onDeal({ banker_seat, banker_card, my_hand }) {\n        databus.bankerCard = banker_card;\n        this.handCompList.forEach(({ sprite, script }, i) => {\n            script.cardIndex = my_hand[i];\n            sprite.spriteFrame = databus.cardSpriteFrames[script.cardIndex];\n            sprite.entity.active = true;\n        });\n\n        if (banker_seat === databus.mySeat) {\n            this.bankerCardSprite.spriteFrame = databus.cardSpriteFrames[banker_card];\n            this.bankerCardSprite.visible = true;\n\n            this.changeButton.entity.active = true;\n            this.skipButton.entity.active = true;\n            this.onClickHandCard = this.onSelectBankerCard;\n        } else {\n            this.onClickHandCard = this.onSelectActionCards;\n        }\n    }\n\n    private onPlayerPlay({ action, next_seat, scorer }) {\n        if (scorer !== undefined) {\n            this.lastActionModel = null;\n            this.checkPlay();\n\n            wx.showToast({\n                title: 'New Round',\n                icon: 'none',\n                duration: 1000,\n                mask: true\n            });\n            setTimeout(() => {\n                this.hideAction();\n                this.playButton.entity.active = next_seat === databus.mySeat;\n            }, 1000);\n            return;\n        }\n\n        if (action.model !== null) {\n            this.lastActionModel = action.model;\n            this.checkPlay();\n        }\n\n        if (next_seat === databus.mySeat) {\n            this.hideAction();\n            this.playButton.entity.active = true;\n            this.passButton.entity.active = true;\n        }\n    }\n\n    private onSelectBankerCard(selected: boolean, script: MyHandCard) {\n        if (selected) {\n            this.selectedBankerCard?.putBack();\n            this.selectedBankerCard = script;\n            this.enableChange();\n        } else {\n            this.selectedBankerCard = null;\n            this.disableChange();\n        }\n    }\n\n    private onSelectActionCards(selected: boolean, script: MyHandCard) {\n        if (selected) {\n            this.selectedActionCards.add(script);\n        } else {\n            this.selectedActionCards.remove(script);\n        }\n        this.checkPlay();\n    }\n\n    private change() {\n        engine.game.customEventEmitter.emit('change_banker_card', {\n            banker_card: this.selectedBankerCard.cardIndex\n        }, () => {\n            this.bankerCardSprite.spriteFrame = databus.cardSpriteFrames[this.selectedBankerCard.cardIndex];\n            this.skip();\n        });\n    }\n\n    private skip() {\n        this.selectedBankerCard?.putBack();\n        this.selectedBankerCard = null;\n        this.hideChangeSkip();\n        this.playButton.entity.active = true;\n        this.onClickHandCard = this.onSelectActionCards;\n    }\n\n    private play() {\n        engine.game.customEventEmitter.emit('play', {\n            action: this.selectedActionCards.action\n        }, () => {\n            this.selectedActionCards.sortedCardScriptList.forEach((script, i) => {\n                script.entity.active = false;\n                this.actionSpriteList[i].spriteFrame = databus.cardSpriteFrames[script.cardIndex];\n                this.actionSpriteList[i].entity.active = true;\n            });\n\n            if (!this.bankerCardSprite.visible && this.selectedActionCards.cardList.includes(databus.bankerCard)) {\n                this.bankerCardSprite.spriteFrame = databus.cardSpriteFrames[databus.bankerCard];\n                this.bankerCardSprite.visible = true;\n            }\n\n            this.selectedActionCards.clear();\n            this.hidePlayPass();\n        });\n    }\n\n    private pass() {\n        engine.game.customEventEmitter.emit('play', {\n            action: {\n                model: null,\n                cards: []\n            }\n        }, () => {\n            this.selectedActionCards.cardScriptList.forEach(v => v.putBack());\n            this.passSprite.visible = true;\n            this.selectedActionCards.clear();\n            this.hidePlayPass();\n        });\n    }\n\n    private checkPlay() {\n        if (this.selectedActionCards.greaterThan(this.lastActionModel)) {\n            this.enablePlay();\n        } else {\n            this.disablePlay();\n        }\n    }\n\n    private disableChange() {\n        this.changeButton.disable = true;\n        this.changeTouchInput.active = false;\n    }\n\n    private enableChange() {\n        this.changeButton.disable = false;\n        this.changeTouchInput.active = true;\n    }\n\n    private disablePlay() {\n        this.playButton.disable = true;\n        this.playTouchInput.active = false;\n    }\n\n    private enablePlay() {\n        this.playButton.disable = false;\n        this.playTouchInput.active = true;\n    }\n\n    private hideChangeSkip() {\n        this.changeButton.entity.active = false;\n        this.skipButton.entity.active = false;\n    }\n\n    private hidePlayPass() {\n        this.playButton.entity.active = false;\n        this.passButton.entity.active = false;\n    }\n\n    private hideHand() {\n        this.handCompList.forEach(({ sprite, script }) => {\n            sprite.entity.active = false;\n            script.putBack();\n        });\n    }\n\n    private hideAction() {\n        this.actionSpriteList.forEach(sprite => sprite.entity.active = false);\n        this.passSprite.visible = false;\n    }\n}\n"]}