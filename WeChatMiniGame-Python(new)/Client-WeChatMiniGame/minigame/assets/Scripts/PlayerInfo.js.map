{"version":3,"sources":["__temp/buildProcess/inlineFunctionProcess/Scripts/PlayerInfo.ts"],"names":[],"mappings":";;;AAAA,iCAA4B;AAC5B,qCAAoC;AACpC,iCAA2C;AAI3C;IAAwC,sCAAa;IAArD;;IA4EA,CAAC;IAhEU,4BAAO,GAAd;QACI,IAAI,CAAC,IAAI,EAAE,CAAC;QAEZ,gBAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,EAAE,CAAC,yBAAyB,EAAE,IAAI,CAAC,2BAA2B,CAAC,CAAC;QAC/F,gBAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,EAAE,CAAC,cAAc,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;QAC3E,gBAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,EAAE,CAAC,aAAa,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;IAC7E,CAAC;IAEO,yBAAI,GAAZ;QACI,IAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QAC9B,IAAI,CAAC,IAAI,GAAG,CAAC,iBAAO,CAAC,MAAM,GAAG,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;QAE1E,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC,MAAM,CAAC;QAE/E,IAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;QAClE,IAAI,CAAC,YAAY,GAAG,SAAS,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,YAAY,CAAC,gBAAM,CAAC,QAAQ,CAAC,CAAC;QAC7G,IAAI,CAAC,aAAa,GAAG,SAAS,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,YAAY,CAAC,gBAAM,CAAC,OAAO,CAAC,CAAC;QAE/F,IAAI,CAAC,2BAA2B,GAAG,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC1E,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACxD,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC1D,CAAC;IAEM,8BAAS,GAAhB;QACI,gBAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC,yBAAyB,EAAE,IAAI,CAAC,2BAA2B,CAAC,CAAC;QAC3G,gBAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC,cAAc,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;QACvF,gBAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC,aAAa,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;IACzF,CAAC;IAEO,2CAAsB,GAA9B,UAA+B,EAAe;YAAb,WAAW,iBAAA;QACxC,IAAM,IAAI,GAAG,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACpC,IAAI,IAAI,EAAE;YACN,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;SACvB;aAAM;YACH,IAAI,CAAC,WAAW,EAAE,CAAC;SACtB;IACL,CAAC;IAEO,kCAAa,GAArB,UAAsB,EAAc;YAAZ,IAAI,UAAA,EAAE,IAAI,UAAA;QAC9B,IAAI,KAAK,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;IAC9C,CAAC;IAEO,iCAAY,GAApB,UAAqB,EAAQ;YAAN,IAAI,UAAA;QACvB,IAAI,KAAK,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;IAC7C,CAAC;IAEO,6BAAQ,GAAhB,UAAiB,EAAwB;QAAzC,iBAYC;YAZkB,QAAQ,cAAA,EAAE,UAAU,gBAAA;QACnC,wBAAgB,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,UAAA,MAAM;YACpC,KAAI,CAAC,YAAY,CAAC,WAAW,GAAG,MAAM,CAAC;YACvC,KAAI,CAAC,aAAa,CAAC,IAAI,GAAG,QAAQ,CAAC;YACnC,KAAI,CAAC,aAAa,CAAC,MAAM,GAAG,KAAK,CAAC;YAClC,KAAI,CAAC,aAAa,CAAC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC;YAElE,iBAAO,CAAC,cAAc,CAAC,KAAI,CAAC,IAAI,CAAC,GAAG;gBAChC,MAAM,QAAA;gBACN,QAAQ,UAAA;aACX,CAAC;QACN,CAAC,CAAC,CAAC;IACP,CAAC;IAEO,gCAAW,GAAnB;QACI,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,IAAI,CAAC;QACjC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,KAAK,CAAC;IACvE,CAAC;IA3EgB,UAAU;QAD9B,gBAAM,CAAC,UAAU,CAAC,SAAS,CAAC,YAAY,CAAC;OACrB,UAAU,CA4E9B;IAAD,iBAAC;CA5ED,AA4EC,CA5EuC,gBAAM,CAAC,MAAM,GA4EpD;kBA5EoB,UAAU","file":"PlayerInfo.js","sourcesContent":["import engine from \"engine\";\nimport { databus } from \"./Databus\";\nimport { urlToSpriteFrame } from \"./utils\";\n\n\n@engine.decorators.serialize(\"PlayerInfo\")\nexport default class PlayerInfo extends engine.Script {\n    private defaultEntity: engine.Entity;\n    private avatarSprite: engine.UISprite;\n    private nicknameLabel: engine.UILabel;\n\n    private seat: number;\n\n    private getPlayersInfoResultHandler;\n    private playerEnterHandler;\n    private playerExitHandler;\n\n\n    public onAwake() {\n        this.init();\n\n        engine.game.customEventEmitter.on('get_players_info_result', this.getPlayersInfoResultHandler);\n        engine.game.customEventEmitter.on('player_enter', this.playerEnterHandler);\n        engine.game.customEventEmitter.on('player_exit', this.playerExitHandler);\n    }\n\n    private init() {\n        const name = this.entity.name;\n        this.seat = (databus.mySeat + parseInt(name.charAt(name.length - 1))) % 4;\n\n        this.defaultEntity = this.entity.transform2D.findChildByName('Default').entity;\n\n        const infoTrans = this.entity.transform2D.findChildByName('Info');\n        this.avatarSprite = infoTrans.findChildByName('CircleMask').children[0].entity.getComponent(engine.UISprite);\n        this.nicknameLabel = infoTrans.findChildByName('Nickname').entity.getComponent(engine.UILabel);\n\n        this.getPlayersInfoResultHandler = this.onGetPlayersInfoResult.bind(this);\n        this.playerEnterHandler = this.onPlayerEnter.bind(this);\n        this.playerExitHandler = this.onPlayerExit.bind(this);\n    }\n\n    public onDestroy() {\n        engine.game.customEventEmitter.removeListener('get_players_info_result', this.getPlayersInfoResultHandler);\n        engine.game.customEventEmitter.removeListener('player_enter', this.playerEnterHandler);\n        engine.game.customEventEmitter.removeListener('player_exit', this.playerExitHandler);\n    }\n\n    private onGetPlayersInfoResult({ player_list }) {\n        const info = player_list[this.seat];\n        if (info) {\n            this.showInfo(info);\n        } else {\n            this.showDefault();\n        }\n    }\n\n    private onPlayerEnter({ seat, info }) {\n        seat === this.seat && this.showInfo(info);\n    }\n\n    private onPlayerExit({ seat }) {\n        seat === this.seat && this.showDefault();\n    }\n\n    private showInfo({ nickname, avatar_url }) {\n        urlToSpriteFrame(avatar_url).then(avatar => {\n            this.avatarSprite.spriteFrame = avatar;\n            this.nicknameLabel.text = nickname;\n            this.defaultEntity.active = false;\n            this.nicknameLabel.entity.transform2D.parent.entity.active = true;\n\n            databus.playerInfoList[this.seat] = {\n                avatar,\n                nickname\n            };\n        });\n    }\n\n    private showDefault() {\n        this.defaultEntity.active = true;\n        this.nicknameLabel.entity.transform2D.parent.entity.active = false;\n    }\n}\n"]}