{"version":3,"sources":["__temp/buildProcess/inlineFunctionProcess/Scripts/GameServer.ts"],"names":[],"mappings":";;AAAA;IAII,oBAA2B,QAAQ,EAAU,SAAS,EAAU,MAAM,EAAU,iBAAiB;QAAtE,aAAQ,GAAR,QAAQ,CAAA;QAAU,cAAS,GAAT,SAAS,CAAA;QAAU,WAAM,GAAN,MAAM,CAAA;QAAU,sBAAiB,GAAjB,iBAAiB,CAAA;QAHzF,eAAU,GAA8B,IAAI,CAAC;QAC7C,QAAG,GAAG,iBAAiB,CAAC;IAGhC,CAAC;IAED,sBAAW,8BAAM;aAAjB;YACI,OAAO,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,UAAU,KAAK,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC;QAClF,CAAC;;;OAAA;IAEM,4BAAO,GAAd,UAAe,KAAK;QAApB,iBAyBC;QAxBG,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC,aAAa,CAAC;YAC/B,GAAG,EAAE,IAAI,CAAC,GAAG;YACb,MAAM,EAAE;gBACJ,aAAa,EAAE,IAAI,CAAC,SAAS,CAAC;oBAC1B,QAAQ,EAAE,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC;oBAClC,UAAU,EAAE,IAAI,CAAC,SAAS;oBAC1B,MAAM,EAAE,IAAI,CAAC,MAAM;oBACnB,KAAK,OAAA;iBACR,CAAC;aACL;SACJ,CAAC,CAAC;QACH,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,UAAA,GAAG;YACtB,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,GAAG,CAAC,CAAC;QACvC,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAA,GAAG;YACvB,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,GAAG,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAA,GAAG;YACvB,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,GAAG,CAAC,CAAC;YACnC,KAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QAC3B,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,UAAA,GAAG;YACzB,KAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAc,CAAC,CAAC,CAAC;QAC3D,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,gCAAW,GAAlB,UAAmB,GAAG;QAAtB,iBAmBC;QAlBG,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YAC/B,IAAI,KAAI,CAAC,UAAU,KAAK,IAAI,EAAE;gBAC1B,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;gBACjC,MAAM,EAAE,CAAC;aACZ;iBAAM;gBACH,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC;oBACjB,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC;oBACzB,OAAO,EAAE;wBACL,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,GAAG,CAAC,CAAC;wBAClC,OAAO,EAAE,CAAC;oBACd,CAAC;oBACD,IAAI,EAAE;wBACF,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;wBACjC,MAAM,EAAE,CAAC;oBACb,CAAC;iBACJ,CAAC,CAAC;aACN;QACL,CAAC,CAAC,CAAC;IACP,CAAC;IAEM,0BAAK,GAAZ;QACI,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;QAC7C,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QACvB,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;IACnC,CAAC;IACL,iBAAC;AAAD,CAhEA,AAgEC,IAAA","file":"GameServer.js","sourcesContent":["export default class GameServer {\r\n    private socketTask: WechatMinigame.SocketTask = null;\r\n    private url = 'wss://wiwilz.cn';\r\n\r\n    public constructor(private nickname, private avatarUrl, private openid, private onMessageCallback) {\r\n    }\r\n\r\n    public get isOpen() {\r\n        return this.socketTask && this.socketTask.readyState === this.socketTask.OPEN;\r\n    }\r\n\r\n    public connect(event) {\r\n        this.socketTask = wx.connectSocket({\r\n            url: this.url,\r\n            header: {\r\n                Authorization: JSON.stringify({\r\n                    nickname: encodeURI(this.nickname),\r\n                    avatar_url: this.avatarUrl,\r\n                    openid: this.openid,\r\n                    event\r\n                })\r\n            }\r\n        });\r\n        this.socketTask.onOpen(res => {\r\n            console.log('WebSocket 连接开启', res);\r\n        });\r\n        this.socketTask.onError(res => {\r\n            console.log('WebSocket 异常', res);\r\n        });\r\n        this.socketTask.onClose(res => {\r\n            console.log('WebSocket 连接关闭', res);\r\n            this.socketTask = null;\r\n        });\r\n        this.socketTask.onMessage(res => {\r\n            this.onMessageCallback(JSON.parse(res.data as string));\r\n        });\r\n    }\r\n\r\n    public sendMessage(msg) {\r\n        return new Promise((resolve, reject) => {\r\n            if (this.socketTask === null) {\r\n                console.log('send message fail');\r\n                reject();\r\n            } else {\r\n                this.socketTask.send({\r\n                    data: JSON.stringify(msg),\r\n                    success: () => {\r\n                        console.log('send message:', msg);\r\n                        resolve();\r\n                    },\r\n                    fail: () => {\r\n                        console.log('send message fail');\r\n                        reject();\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    public close() {\r\n        this.socketTask && this.socketTask.close({});\r\n        this.socketTask = null;\r\n        console.log('websocket close');\r\n    }\r\n}"]}